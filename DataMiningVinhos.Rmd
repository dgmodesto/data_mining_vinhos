---
title: " Análise Exploratória da Base de Vinhos"
output: html_document
--- 
# 1. Introdução

Nos últimos anos o setor vinícola e os setores de tecnologia estão sendo foco de diversos tipos de desenvolvimento. Será apresentado neste trabalho a aplicação de análises exploratórias dos dados de vinhos utilizando a linguagem R. O objetivo é abordar alguns dos  pressupostos que interligam o setor vinícola com técnicas específicas de data mining e verificar até que ponto esta interligação pode melhorar a tomada de decisão.


## 1.1. Instalando e carregando as bibliotecas

Remove mensagens de alerta:
```{r}
options( warn = -1 )
```

Instala as bibliotecas utilizadas para execução do código.
```{r}
#install.packages('dplyr')
#install.packages('readr')
#install.packages('plotly')
#install.packages('scales')
#install.packages("psych")
#install.packages("corrgram")
#install.packages('rgdal')
#install.packages('RColorBrewer')
#install.packages('sp')
#install.packages('leaflet')
#install.packages('bindrcpp')
#install.packages('magrittr')
#install.packages('ggplot2')
#install.packages('lubridate')
#install.packages('grid') 
#install.packages('quantile')
#install.packages('hexbin')
#install.packages('gmodels')
#install.packages('psych')
#install.packages('standardize')
```

Carrega as bibliotecas utilizadas para execução do código.

```{r}
library('dplyr')
library('readr')
library('plotly')
library('scales')
library('hexbin')
library('rgdal')
library('RColorBrewer')
library('sp')
library('leaflet')
library('bindrcpp')
library('magrittr')
library('dplyr')
library('ggplot2')
library('lubridate')
library('grid') 
library('gmodels')
library('psych')
library('corrgram')
library('standardize')
```


## 1.2. Carregando a base de dados

Base de dados de Vinhos para ser carregado em memória. Será dividida em *train* utilizado para treino e *test* para testes na nossa análise e modelo de predição.
```{r }
base = read.csv2("data/base.csv")
```

Mostra até duas casas decimais
```{r}
options("scipen" = 2)
```

## 1.3. Estrutura de Dados
### Item 1

Visualizando a estrutura geral do conjuntos de dados, usando o comando summary:
```{r}
summary(base)
```

### Item 2
Mostra as colunas que temos no Dataset e suas respectivas medidas, como, por exemplo, máximo, mínimo, média, mediana etc:
```{r}
describe(base)
```

Na tabela apresentada acima conseguimos visualizar algumas informações interessantes. Por exemplo, podemos verificar a média, mediana, valores mínimos, valores máximos entre outras informações de cada propriedade do nosso dataset. 


Agora que conhecemos nossos valores iremos dentificar os tipos de dados das propriedades do dataset:
```{r}
class(base$id_vinho)
class(base$fixedacidity)
class(base$volatileacidity)
class(base$citricacid)
class(base$residualsugar)
class(base$chlorides)
class(base$freesulfurdioxide)
class(base$totalsulfurdioxide)
class(base$density)
class(base$pH)
class(base$sulphates)
class(base$alcohol)
class(base$quality)
class(base$Vinho)
```

Com exceção da propriedade Vinho, todas as outras propriedades são númericas inteiros e reais.


### Item 3
Neste momento iremos verificamos se há valores nulos na base para um possível tratamento, caso haja valores nulos em alguma propriedade nesta base, poderiamos por exemplo utilizar o valor da média ou mediana para substitiuir esses valores nulo e assim manter a base completa.
```{r}
sum(is.na(base))
```


O codigo acima responsável por buscar valores nulos na base, mostrou que não há valores nulos ou vazios nesta base, com isso, não será necessário realizar algum tratramento nessa base.

## 1.4. Normalização de Dados


### Item 5
Possuímos uma variável categórica, da qual transformaremos em numérica para melhor trabalharmos em cima de nossos algoritmos. A variável é VINHO, que possui os valores "RED" e "WHITE":
```{r}
#transformando o campo Vinho
base$Vinho = as.numeric(base$Vinho)

head(base)
```

### Item 4
Como falamos anteriormente, há alguns valores discrepantes nesta base de dados, com tudo, precisamos realizar alguma técnica de normalização para estes dados com a necessidade de harmonizar as escalas, então, optamos por utilizar a tecnica de normalização Min-Max.

No código abaixo ocorre a normalização dos dados numéricos para melhor trabalharmos com um range apropriado de valores em nossos algoritmos, mas antes disso foi necessário alterar nossa variável categorica Vinho em valor numérico.

```{r}
train_normalizado = (base-min(base))/(max(base)-min(base))

head(train_normalizado)
```

Depois de aplicar o comando de normalização min-max, e feito a harmonização dos dados, já podemos ver que os dados estão todos na mesma scala entre Zero e Um. Este processo corresponde na verdade à adaptação de scalas  que fazemos ao criar um gráfico de eixos X e Y com duas grandezas muito bem definidda


## 1.5 Aplicação de Algoritmos
### Item 6

Analisar a correlação entre as variáveis com o nosso target para identificar as variáveis com maior importância, caso necessário, fazer iterações entre elas:
```{r}
#correlação de todas as variáveis, ordenadas de 1 a -1
cor(base$Vinho,base$totalsulfurdioxide)
cor(base$Vinho,base$totalsulfurdioxide)
cor(base$Vinho,base$freesulfurdioxide)
cor(base$Vinho,base$residualsugar)
cor(base$Vinho,base$citricacid)
cor(base$Vinho,base$quality)
cor(base$Vinho,base$alcohol)
cor(base$Vinho,base$id_vinho)
cor(base$Vinho,base$pH)
cor(base$Vinho,base$density)
cor(base$Vinho,base$sulphates)
cor(base$Vinho,base$fixedacidity)
cor(base$Vinho,base$chlorides)
cor(base$Vinho,base$volatileacidity)
```

### Item 7

Dividindo o dataset em 30% Teste e 70% Treino
```{r}
## 70% do tamanho da base
smp_size <- floor(0.7 * nrow(base))

## coloca o seed para fazer sua partição reproduzível
set.seed(1)
train_ind <- sample(seq_len(nrow(base)), size = smp_size)

train <- base[train_ind, ]
test <- base[-train_ind, ]
```

### Item 8

Utilizamos o método StepWise para seleção de variáveis e aplicar um algoritmo de regressão linear:
```{r}
attach(train)
```

```{r}
#modelo com todas as variáveis
modelo1 <- lm(Vinho ~ totalsulfurdioxide+freesulfurdioxide+residualsugar+citricacid+quality+alcohol+id_vinho+pH+density+sulphates+fixedacidity+chlorides+volatileacidity)
summary(modelo1)
```

```{r}
#não excluiu nenhuma variável
forward<-step(modelo1,direction="forward")
forward
summary(forward)
```

```{r}
#excluiu a variável id_vinho
backward<-step(modelo1,direction="backward")
backward
summary(backward)
```

```{r}
#excluiu a variável id_vinho
stepwise<-step(modelo1,direction="both")
stepwise
summary(stepwise)
```

```{r}
#modelo sem a variável id_vinho
modelo2 <- lm(Vinho ~ totalsulfurdioxide+freesulfurdioxide+residualsugar+citricacid+quality+alcohol+pH+density+sulphates+fixedacidity+chlorides+volatileacidity)
summary(modelo2)
```